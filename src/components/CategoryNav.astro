---
import { l, type Locale } from '../i18n/utils';

interface NavItem {
  id: string;
  label: { en: string; ua: string };
}

interface Props {
  items: NavItem[];
  locale: Locale;
}

const { items, locale } = Astro.props;
---

<nav class="sticky top-[53px] sm:top-[60px] z-40 bg-warm-50/95 backdrop-blur-sm border-b border-warm-200 -mx-4 px-4 overflow-x-auto scrollbar-hide">
  <div class="flex gap-1 sm:gap-2 py-2 min-w-max">
    {items.map((item) => (
      <a
        href={`#${item.id}`}
        class="px-3 sm:px-4 py-2 text-sm font-medium text-warm-600 hover:text-brand-700 active:text-brand-800 transition-colors whitespace-nowrap relative after:absolute after:bottom-1 after:left-3 after:right-3 after:h-[1px] after:bg-brand-700 after:scale-x-0 hover:after:scale-x-100 after:transition-transform after:origin-left"
        data-nav-link={item.id}
      >
        {l(item.label, locale)}
      </a>
    ))}
  </div>
</nav>

<style>
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  // Highlight active section in navigation
  document.addEventListener('DOMContentLoaded', () => {
    const links = document.querySelectorAll('[data-nav-link]');
    const sections = new Map<string, Element>();

    links.forEach(link => {
      const id = (link as HTMLElement).dataset.navLink!;
      const section = document.getElementById(id);
      if (section) sections.set(id, section);
    });

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            links.forEach(l => {
              l.classList.remove('text-brand-700', 'font-semibold');
              l.classList.add('text-warm-600');
            });
            const activeLink = document.querySelector(`[data-nav-link="${entry.target.id}"]`);
            activeLink?.classList.remove('text-warm-600');
            activeLink?.classList.add('text-brand-700', 'font-semibold');
          }
        });
      },
      { rootMargin: '-80px 0px -70% 0px', threshold: 0 }
    );

    sections.forEach(section => observer.observe(section));
  });
</script>
