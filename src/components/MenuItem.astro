---
import DietaryBadge from './DietaryBadge.astro';
import { l, type Locale } from '../i18n/utils';

interface Variant {
  label: { en: string; ua: string };
  price: number;
}

interface Props {
  item: {
    id: string;
    name: { en: string; ua: string };
    description: { en: string; ua: string };
    price?: number;
    variants?: Variant[];
    note?: { en: string; ua: string };
    dietary: string[];
  };
  locale: Locale;
}

const { item, locale } = Astro.props;
const name = l(item.name, locale);
const description = l(item.description, locale);
const note = item.note ? l(item.note, locale) : null;
const hasVariants = item.variants && item.variants.length > 0;
---

<div class="group py-4 first:pt-0 last:pb-0 pl-3 border-l-2 border-transparent hover:border-brand-400 transition-all duration-200">
  <div class="flex items-start justify-between gap-3">
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-2 flex-wrap">
        <h3 class="text-base font-semibold text-warm-900 group-hover:text-brand-800 transition-colors">{name}</h3>
        {item.dietary.length > 0 && (
          <div class="flex gap-1">
            {item.dietary.map((d) => (
              <DietaryBadge type={d} locale={locale} />
            ))}
          </div>
        )}
      </div>
      {description && (
        <p class="mt-1 text-sm text-warm-600 leading-relaxed">{description}</p>
      )}
      {note && (
        <p class="mt-1 text-xs text-warm-500 italic">{note}</p>
      )}
    </div>
    {hasVariants ? (
      <div class="flex flex-col items-end gap-0.5 shrink-0">
        {item.variants!.map((v) => (
          <div class="flex items-center gap-2">
            <span class="text-xs text-warm-500">{l(v.label, locale)}</span>
            <span class="text-sm font-bold text-brand-700 tabular-nums whitespace-nowrap">
              ${v.price.toFixed(0)}
            </span>
          </div>
        ))}
      </div>
    ) : item.price !== undefined ? (
      <span class="text-lg font-bold text-brand-700 whitespace-nowrap shrink-0 tabular-nums">
        ${item.price.toFixed(2)}
      </span>
    ) : null}
  </div>
</div>
