---
import Layout from '../../../layouts/Layout.astro';
import MenuSection from '../../../components/MenuSection.astro';
import CategoryNav from '../../../components/CategoryNav.astro';
import PdfDownload from '../../../components/PdfDownload.astro';
import SchemaMenu from '../../../components/SchemaMenu.astro';
import { t, l, type Locale } from '../../../i18n/utils';
import menuMain from '../../../data/menu-main.json';
import menuCrepes from '../../../data/menu-crepes.json';
import menuDrinks from '../../../data/menu-drinks.json';
import menuCatering from '../../../data/menu-catering.json';
import restaurant from '../../../data/restaurant.json';

export function getStaticPaths() {
  return [
    { params: { locale: 'en' } },
    { params: { locale: 'ua' } },
  ];
}

const locale = Astro.params.locale as Locale;
const ui = t(locale);
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

const navItems = [
  { id: menuMain.id, label: menuMain.title },
  { id: menuCrepes.id, label: menuCrepes.title },
  { id: menuDrinks.id, label: menuDrinks.title },
  { id: menuCatering.id, label: menuCatering.title },
];

const allMenus = [menuMain, menuCrepes, menuDrinks, menuCatering];
---

<Layout title={ui.menu.title} locale={locale} description={ui.menu.description}>
  <SchemaMenu menus={allMenus} locale={locale} slot="head" />

  <div class="max-w-3xl mx-auto px-4 py-8 sm:py-12">
    <!-- Page title — matching PDF style -->
    <div class="text-center mb-8">
      <!-- Logo -->
      <div class="flex justify-center mb-4">
        <img
          src={`${base}/logo/logo-256.png`}
          alt="ColorEat Cafe"
          class="w-20 sm:w-24 h-auto"
          width="256"
          height="256"
        />
      </div>
      <p class="font-serif text-xs sm:text-sm uppercase tracking-[0.15em] text-warm-500 mb-3">
        {ui.home.heroTitle}
      </p>
      <div class="ornate-divider mb-4">
        <span class="text-gold-400 text-sm">&#9670;</span>
      </div>
      <h1 class="text-3xl sm:text-4xl font-serif font-semibold text-brand-700 mb-2 tracking-wide">
        {ui.menu.title}
      </h1>
      <p class="text-warm-500 text-sm italic">{l(restaurant.subtitle, locale)}</p>
    </div>

    <!-- Category navigation -->
    <CategoryNav items={navItems} locale={locale} />

    <!-- Menu sections -->
    <div class="mt-8 space-y-14">
      <MenuSection
        menuTitle={menuMain.title}
        categories={menuMain.categories}
        locale={locale}
        menuId={menuMain.id}
        featured={menuMain.featured}
      />

      <MenuSection
        menuTitle={menuCrepes.title}
        categories={menuCrepes.categories}
        locale={locale}
        menuId={menuCrepes.id}
      />

      <MenuSection
        menuTitle={menuDrinks.title}
        categories={menuDrinks.categories}
        locale={locale}
        menuId={menuDrinks.id}
      />

      <MenuSection
        menuTitle={menuCatering.title}
        categories={menuCatering.categories}
        locale={locale}
        menuId={menuCatering.id}
      />
    </div>

    <!-- Allergy notice — matching PDF footer note -->
    <div class="mt-12 text-center">
      <div class="ornate-divider mb-4">
        <span class="text-gold-400 text-sm">&#9670;</span>
      </div>
      <p class="text-sm text-warm-500 italic">
        {ui.menu.allergyNotice}
      </p>
    </div>

    <!-- PDF downloads -->
    <div class="mt-8">
      <PdfDownload locale={locale} />
    </div>
  </div>

  <!-- Scroll reveal script -->
  <script>
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('revealed');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
    );
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
  </script>
</Layout>
