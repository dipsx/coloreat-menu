---
import Layout from '../../../layouts/Layout.astro';
import MenuSection from '../../../components/MenuSection.astro';
import CategoryNav from '../../../components/CategoryNav.astro';
import PdfDownload from '../../../components/PdfDownload.astro';
import SchemaMenu from '../../../components/SchemaMenu.astro';
import { t, l, type Locale } from '../../../i18n/utils';
import menuMain from '../../../data/menu-main.json';
import menuCrepes from '../../../data/menu-crepes.json';
import menuDrinks from '../../../data/menu-drinks.json';
import menuCatering from '../../../data/menu-catering.json';
import restaurant from '../../../data/restaurant.json';

export function getStaticPaths() {
  return [
    { params: { locale: 'en' } },
    { params: { locale: 'ua' } },
  ];
}

const locale = Astro.params.locale as Locale;
const ui = t(locale);
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

const navItems = [
  { id: menuMain.id, label: menuMain.title },
  { id: menuCrepes.id, label: menuCrepes.title },
  { id: menuDrinks.id, label: menuDrinks.title },
  { id: menuCatering.id, label: menuCatering.title },
];

const allMenus = [menuMain, menuCrepes, menuDrinks, menuCatering];
---

<Layout title={ui.menu.title} locale={locale} description={ui.menu.description}>
  <SchemaMenu menus={allMenus} locale={locale} slot="head" />

  <div class="max-w-3xl mx-auto px-4 py-8 sm:py-12">
    <!-- Page title -->
    <div class="text-center mb-8">
      <!-- Logo -->
      <div class="flex justify-center mb-3">
        <img
          src={`${base}/logo/logo-256.png`}
          alt="ColorEat Cafe"
          class="w-16 sm:w-20 h-auto"
          width="256"
          height="256"
        />
      </div>
      <h1 class="text-4xl sm:text-5xl font-normal font-[Great_Vibes] text-brand-800 mb-2">
        {ui.menu.title}
      </h1>
      <p class="text-warm-500 text-sm italic">{l(restaurant.subtitle, locale)}</p>
      <div class="ornate-divider mt-4">
        <span class="text-gold-400 text-sm">&#9670;</span>
      </div>
    </div>

    <!-- Category navigation -->
    <CategoryNav items={navItems} locale={locale} />

    <!-- Menu sections -->
    <div class="mt-8 space-y-12">
      <MenuSection
        menuTitle={menuMain.title}
        categories={menuMain.categories}
        locale={locale}
        menuId={menuMain.id}
        featured={menuMain.featured}
      />

      <MenuSection
        menuTitle={menuCrepes.title}
        categories={menuCrepes.categories}
        locale={locale}
        menuId={menuCrepes.id}
      />

      <MenuSection
        menuTitle={menuDrinks.title}
        categories={menuDrinks.categories}
        locale={locale}
        menuId={menuDrinks.id}
      />

      <MenuSection
        menuTitle={menuCatering.title}
        categories={menuCatering.categories}
        locale={locale}
        menuId={menuCatering.id}
      />
    </div>

    <!-- Allergy notice -->
    <div class="mt-10 p-4 bg-amber-50 border border-amber-200 rounded-xl text-center">
      <p class="text-sm text-amber-800">
        <svg class="w-4 h-4 inline-block mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        {ui.menu.allergyNotice}
      </p>
    </div>

    <!-- PDF downloads -->
    <div class="mt-8">
      <PdfDownload locale={locale} />
    </div>
  </div>

  <!-- Scroll reveal script -->
  <script>
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('revealed');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
    );
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
  </script>
</Layout>
